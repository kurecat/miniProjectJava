<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AjiteU - 글쓰기 (Naver SmartEditor 2.0)</title>

    <script th:src="@{/smarteditor2/js/service/HuskyEZCreator.js}"></script>
    <style>
        /* (CSS는 이전과 동일하게 유지) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Malgun Gothic", "맑은 고딕", sans-serif; background-color: #f0f0f0; }
        ul, li { list-style: none; }
        a { text-decoration: none; color: inherit; }
        .container { width: 1295px; margin: 0 auto; background-color: #fdf6e3; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        header { width: 100%; }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; height: 100px; }
        .logo { font-size: 36px; font-weight: bold; color: #a98c71; }
        .top-center-box { width: 300px; height: 50px; background-color: #dcdcdc; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #555; }
        .main-nav { width: 100%; height: 65px; background-color: #a98c71; display: flex; align-items: center; padding-left: 20px; }
        .main-nav ul { display: flex; }
        .main-nav li { margin-right: 25px; }
        .main-nav a { color: white; font-size: 18px; font-weight: bold; }
        .content-write-page { display: flex; padding: 20px; background-color: #fdf6e3; }
        .write-area { width: 970px; }
        .write-options-bar { width: 100%; height: 35px; display: flex; justify-content: space-between; border: 1px solid #ccc; margin-bottom: 15px; font-size: 14px; }
        .write-options-bar > div { display: flex; align-items: center; justify-content: center; padding: 0 10px; background-color: white; }
        .font-controls { width: 145px; border-right: 1px solid #ccc; }
        .category-select { width: 680px; }
        .write-mode { width: 110px; border-left: 1px solid #ccc; }
        .title-input { width: 100%; height: 40px; font-size: 1.5rem; padding: 5px 10px; border: 1px solid #ccc; margin-bottom: 15px; box-sizing: border-box; }

        /* [제거] CKEditor 스타일
        .ck-editor__editable { min-height: 520px; }
        */

        /* [추가] SmartEditor 2.0은 textarea를 숨기므로, 툴바 높이에 맞춰 하단 요소 위치 조절 */
        .file-attach-bar { margin-top: 15px; }

        /* (기존 CSS 계속) */
        .file-attach-bar { width: 100%; height: 60px; border: 1px solid #ccc; display: flex; align-items: center; padding: 0 10px; background-color: white; margin-bottom: 15px; }
        .attach-button-box { width: 320px; height: 40px; background-color: #a98c71; color: white; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        .attach-info { margin-left: 15px; font-size: 14px; color: #555; }
        .post-options { font-size: 14px; color: #333; margin-bottom: 20px; }
        .post-options label { margin-right: 15px; }
        .button-container { display: flex; justify-content: flex-end; width: 100%; }
        .button-container button { height: 45px; border: none; color: white; font-size: 16px; font-weight: bold; cursor: pointer; margin-left: 10px; }
        .btn-submit { width: 90px; background-color: #7971a9; }
        .btn-cancel { width: 115px; background-color: #a98c71; }
        .sidebar-right { width: 250px; height: 885px; background-color: #e9e9e3; margin-left: 20px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #555; }
        footer { width: 100%; height: 65px; background-color: #a98c71; padding: 30px; text-align: center; color: white; }
        .font-controls select { height: 28px; border: 1px solid #ccc; border-radius: 3px; background-color: #f9f9f9; font-size: 13px; padding: 0 2px; cursor: pointer; margin: 0 2px; }

        /* [수정] 폰트 컨트롤 CSS 이름 변경 */
        .font-dropdown {
            width: 135px; /* (145px - padding/border) */
        }
    </style>
</head>
<body>
<div class="container">
    <div th:replace="fragments/header :: header"></div>
    <main class="content-write-page">

        <form
                class="write-area"
                th:action="@{/board/write}"
                th:object="${postForm}"
                method="post"
                onsubmit="return submitContents(this);"
        >
            <div class="write-options-bar">
                <div class="font-controls">
                    <select class="font-dropdown" name="fontSize">
                        <option value="9pt">9pt</option>
                        <option value="10pt">10pt</option>
                        <option value="11pt" selected>11pt</option>
                        <option value="12pt">12pt</option>
                    </select>
                </div>
                <input
                        type="text"
                        th:field="*{title}"
                        placeholder="제목을 입력하세요."
                        class="title-input"
                />
            </div>

            <textarea th:field="*{content}" style="width: 100%;">
                    <p>여기에 내용을 입력하세요.</p>
                </textarea>

            <div class="file-attach-bar">
                <div class="attach-button-box">(W 320 H 40) 사진 및 파일 첨부</div>
                <span class="attach-info">왼쪽의 버튼을 클릭하여 첨부하세요.</span>
            </div>

            <div class="post-options">
                <label>
                    <input type="checkbox" th:field="*{allowComments}" /> 댓글 허용
                </label>
                <label>
                    <input type="checkbox" th:field="*{extraOption}" /> 기타
                </label>
            </div>

            <div class="button-container">
                <button class="btn-submit" type="submit">등록</button>
                <button
                        class="btn-cancel"
                        type="button"
                        th:onclick="|location.href='@{/board/list}'|"
                >
                    돌아가기
                </button>
            </div>
        </form>

        <aside class="sidebar-right">(W 250 H 885)</aside>
    </main>
    <div th:replace="fragments/footer :: footer"></div>
</div>

<script>
    var oEditors = []; // 에디터 인스턴스를 저장할 전역 변수

    // 1. SmartEditor 2.0 생성
    nhn.husky.EZCreator.createInIFrame({
        oAppRef: oEditors, // 전역변수 oEditors에 에디터 인스턴스를 저장

        // th:field="*{content}"가 생성한 textarea의 id="content"를 지정
        elPlaceHolder: "content",

        // 2단계에서 설치한 static 경로
        // (URL 루트 경로부터의 절대 경로로 지정해야 함)
        sSkinURI: "/smarteditor2/SmartEditor2Skin.html",
        htParams: {
            // 툴바 사용 여부 (true: 사용/ false: 미사용)
            bUseToolbar: true,
            // 입력창 크기 조절바 사용 여부 (true: 사용/ false: 미사용)
            bUseVerticalResizer: true,
            // 모드 탭(Editor | HTML | TEXT) 사용 여부 (true: 사용/ false: 미사용)
            bUseModeChanger: true,
            // 기본 글꼴
            fOnBeforeUnload : function(){},
            // (선택) 에디터 높이 지정 (CSS의 .ck-editor__editable {min-height} 대체)
            nHeight: 520
        },

        fCreator: "createSEditor2"
    });

    // 2. [매우 중요] 폼 전송(submit) 전에 SmartEditor의 내용을 textarea로 복사하는 함수
    function submitContents(elForm) {
        try {
            // oEditors[0]는 첫 번째 에디터 인스턴스를 의미합니다.
            // "content" ID를 가진 textarea에 에디터의 HTML 내용을 업데이트합니다.
            oEditors.getById["content"].exec("UPDATE_CONTENTS_FIELD", []);

            // 폼 전송을 계속 진행합니다.
            return true;
        } catch (e) {
            console.error("SmartEditor 2.0 UPDATE_CONTENTS_FIELD 오류:", e);
            // 오류 발생 시 폼 전송을 중단합니다.
            return false;
        }
    }
</script>
</body>
</html>